<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/x-icon" href="../Assets/favicon.ico">
  <title>Find Donar</title>
  <link rel="stylesheet" href="..\Css\find.css" />
  <script src="../js/logCheck.js" defer></script>
  <script src="../js/stateCity.js"></script>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WTE8GK19QM"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-WTE8GK19QM');
</script>
<body>
  <header class="header">
    <div class="div_header">
      <div class="logo">
        <img src="..\Assets\logo.png" alt="Donate Red" class="img" />
      </div>
      <div class="navbar" id="nav">
        <ul class="navbar_list">
          <li>
            <a style=" color: white; text-decoration: none;" href='home.html'>Home</a>
          </li>
          <li>
            <a style=" color: white; text-decoration: none;" href='find.html'>Find Donor</a>
          </li>
          <li>
            <a style=" color: white; text-decoration: none; "href='aboutus.html'>About Us</a>
          </li>
          <li>
            <a style=" color: white; text-decoration: none;" href='blogs.html'>Blogs</a>
          </li>
          <li>
            <a style=" color: white; text-decoration: none; "href='check2.html'>Donate Blood</a>
          </li>
          
        </ul>
        <!-- <h4 id="userName" style="font-weight: bold; font-family: var(--ff-poppins); color: white; margin-left: 20px;">
          FirstName Lastname
        </h4> -->
      </div>
    </div>
  </header>
  <div class="main">
    <div class="content">
      <div class="img-div">
        <img src="..\Assets\blood-icon.png" alt="" height="70px" width="70px" />
      </div>
      <div class="heading">
        <h1 class="connect">Find Donor</h1>
      </div>
      <div class="para">
        <p class="text">
          "Every drop counts. Search for a donor who can make a life-saving
          difference today."
        </p>
      </div>
      <div class="img22">
        <img style="border-radius: 20px;" src="..\Assets\donate.jpg" alt="" />
      </div>
    </div>
    <div class="form-box">
      <form class="form" method="post" action="\findBlood" id="findDonorForm">
        <p class="title">Find Donor</p>
        <!-- <div class="flex">
            <label>
              <input required="" placeholder="" type="text" class="input" />
              <span>Firstname</span>
            </label>

            <label>
              <input required="" placeholder="" type="text" class="input" />
              <span>Lastname</span>
            </label>
          </div>

          <label>
            <input
              required=""
              placeholder="  "
              type="tel"
              class="input"
              id="phone"
              name="phone"
              required
            />
            <span>Phone</span>
          </label>
          <label>
            <input required="" placeholder="" type="email" class="input" />
            <span>Email</span>
          </label> -->
        <label for="blood-type" name="blood-type">
          <select name="bloodtype" id="blood-type" placeholder="Blood-Type" required>
            <option value="Select Your Blood Type">Select Your Blood Type</option>
            <option value="A+">A+</option>
            <option value="A-">A-</option>
            <option value="B+">B+</option>
            <option value="B-">B-</option>
            <option value="AB+">AB+</option>
            <option value="AB-">AB-</option>
            <option value="O+">O+</option>
            <option value="O-">O-</option>
          </select>
          <!-- <span>Blood type</span> -->
        </label>
        <label>
          <select id="state" name="state" required>
            <option value="Select Your State">Select Your State</option>
          </select>
        </label>
        <label>
          <select id="city" name="city" required>
            <option value="Select Your City">Select Your City</option>
          </select>
        </label>
        
        <button class="submit">Submit</button>
      </form>
    </div>
  </div>
</body>
<!-- <script>
    document.getElementById("findDonorForm").addEventListener("submit", function(event) {
        event.preventDefault(); // Prevent form submission

        // Get selected values
        const bloodType = document.getElementById("blood-type").value;
        const state = document.getElementById("state").value;
        const city = document.getElementById("city").value;

        // Redirect to searchDetails.html with parameters
        window.location.href = `../html/searchresult.html?bloodType=${bloodType}&state=${state}&city=${city}`;
    });
</script> -->
<script> 
  document.querySelector(".form").addEventListener("submit", function (e) {
      e.preventDefault(); // Prevent default form submission

      // ✅ Get values from the form
      const bloodType = document.getElementById("blood-type").value;
      const state = document.getElementById("state").value;
      const city = document.getElementById("city").value;

      // ✅ Send data using fetch
      fetch("../Backend/findBlood.php", {
          method: "POST",
          headers: {
              "Content-Type": "application/x-www-form-urlencoded",
          },
          body: `bloodtype=${encodeURIComponent(bloodType)}&state=${encodeURIComponent(state)}&city=${encodeURIComponent(city)}`
      })
      .then(response => response.text()) // Read as text first
      .then(text => {
          try {
              return JSON.parse(text); // Try parsing as JSON
          } catch (error) {
              console.error("Invalid JSON:", text); // Log invalid response
              throw new Error("Invalid JSON response from server");
          }
      })
      .then(data => {
          localStorage.setItem("donorData", JSON.stringify(data)); // Store data
          window.location.href = "../html/searchresult.html"; // Redirect
      })
      .catch(error => console.error("Error:", error));
  });
</script>

</script>

</html>